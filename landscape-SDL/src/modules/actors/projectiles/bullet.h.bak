#include <landscape.h>
#include <Vector.h>
#include <jogi/jogi3d.h>
#include <modules/actors/fx/spark.h>

#define BULLET_TRAIL_BUFFER 3

class Bullet: public IProjectile
{
    typedef struct {
        float p[3];    // the point coords
    } TrailPoint;

    class TrailBuffer : public buffer<TrailPoint, BULLET_TRAIL_BUFFER> { };

public:
    Bullet(IGame *thegame);

    virtual void action();
    virtual IActor::State getState();

    virtual void draw();
    
    virtual void getLocation(float *);
    virtual void getOrientation(float *, float *);
    virtual Vector getMovementVector();

    virtual void shoot(const Vector &pos, const Vector &vec, const Vector &dir);

private:
    void shootSparks();

private:
    static int instances;
    IActor::State state;
    Vector p, v;
    IGame *thegame;
    JRenderer *renderer;
    Ptr<ITerrain> terrain;
    TrailBuffer trail;
};
